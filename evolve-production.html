<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>North Star Academy - Evolve</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Aptos:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  @font-face { font-family: 'Aptos'; src: local('Aptos'), local('Aptos Display'); font-weight: 400; }
  @font-face { font-family: 'Aptos'; src: local('Aptos Bold'), local('Aptos Display Bold'); font-weight: 700; }

  :root { 
    --bg: #FFD1E3; --panel: #A367B1; --user: #8A4F9F; --ink: #E8ECEB;
    --radius: 22px; --header-height: 120px; --footer-height: 120px;
    --brand: var(--panel); --line: rgba(255,255,255,0.1);
    --brand-30: color-mix(in srgb, var(--panel) 30%, transparent);
    --brand-35: color-mix(in srgb, var(--panel) 35%, transparent);
  }

  * { box-sizing: border-box; }
  html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); font-family: 'Aptos', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; color: var(--ink); overflow: hidden; }

  .mn-header-outer.evolve-header { background: var(--panel); width: 100%; height: var(--header-height); position: fixed; top: 0; left: 0; z-index: 9999; display: flex; justify-content: center; align-items: center; }
  .mn-header-inner { display: flex; justify-content: center; align-items: center; gap: 50px; width: 100%; max-width: 1200px; padding: 0 20px; }
  .mn-logo img { height: 38px; object-fit: contain; }
  .mn-nav { display: flex; align-items: center; gap: 20px; }
  .nav-tile { display: flex; flex-direction: column; align-items: center; text-decoration: none; padding: 8px 20px; border-radius: 12px; transition: all .25s ease; min-width: 140px; }
  .nav-tile:hover { background: rgba(255,255,255,.3); transform: translateY(-2px); }
  .nav-tile.active { background: #fff; }
  .nav-tile .nav-name { font-size: 16px; font-weight: 700; color: #000; line-height: 1.2; }
  .nav-tile .nav-desc { font-size: 10px; font-weight: 500; color: rgba(0,0,0,0.7); text-align: center; line-height: 1.2; }

  #chat-input[disabled] { opacity: .45; cursor: not-allowed; }
  button[disabled] { opacity: .4; cursor: not-allowed; pointer-events: none; }
  .pay-btn { background: #FFD93D !important; color: #1A1A1A !important; font-weight: 700; border: 2px solid rgba(0,0,0,0.25) !important; }
  .pay-btn:hover { background: #FFEB7A !important; transform: translateY(-2px); }

  .mn-footer { background: var(--panel); width: 100%; height: var(--footer-height); position: fixed; bottom: 0; left: 0; display: flex; justify-content: center; align-items: center; z-index: 1000; }
  #main-content-area { position: fixed; top: var(--header-height); bottom: var(--footer-height); left: 0; right: 0; display: flex; justify-content: center; align-items: center; padding: 20px; overflow: auto; }
  .mn-footer-inner { width: 100%; max-width: 850px; display: flex; justify-content: space-between; align-items: center; }
  .footer-left, .footer-center, .footer-right { display: flex; flex-direction: column; align-items: center; }
  .footer-left img { width: 60px; margin-bottom: 3px; }
  .footer-left .license-number, .footer-email, .footer-right span { color: #000; font-weight: 700; text-decoration: none; font-size: 0.8rem; }
  .footer-right span { font-size: .75rem; line-height: 1.1; }

  .contrast-panel { background: var(--panel); border-radius: var(--radius); padding: 24px; max-width: 1100px; width: 92%; box-shadow: 0 12px 48px rgba(163,103,177,0.25); animation: fadeIn 0.6s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .ns-grid { display: flex; width: 100%; gap: 28px; align-items: flex-start; }

  .chat-box { flex: 2.5; display: flex; flex-direction: column; background: #000; border: 1px solid var(--line); border-radius: var(--radius); height: 580px; overflow: hidden; margin-right: 6px; }
  #progress-container { display: flex; flex-direction: column; background: rgba(35,45,65,0.9); padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); gap: 10px; position: relative; }
  .action-buttons-bar { display: flex; gap: 8px; flex-wrap: wrap; width: 100%; }
  .desktop-actions { display: flex; gap: 6px; flex: 1; width: 100%; }
  .mobile-actions { display: none; width: 100%; flex: 1; }

  .action-btn { flex: 1; min-width: 70px; padding: 8px 6px; border-radius: 8px; background: rgba(163,103,177,0.3); border: 1px solid rgba(163,103,177,0.5); color: #fff; font-weight: 600; font-size: 11px; cursor: pointer; transition: all 0.2s ease; font-family: 'Aptos', sans-serif; white-space: nowrap; position: relative; }
  .action-btn:hover { background: rgba(163,103,177,0.5); border-color: var(--panel); transform: translateY(-2px); }
  .action-btn.danger { background: rgba(255,80,80,0.25); border: 1px solid rgba(255,80,80,0.5); }
  .action-btn-inner { flex: 1; width: 100%; padding: 8px 10px; border-radius: 8px; background: rgba(163,103,177,0.3); border: 1px solid rgba(163,103,177,0.5); color: #fff; font-weight: 600; font-size: 12px; cursor: pointer; transition: all 0.2s ease; font-family: 'Aptos', sans-serif; }
  .action-btn-inner:hover { background: rgba(163,103,177,0.5); border-color: var(--panel); transform: translateY(-2px); }
  .action-btn-inner.danger { background: rgba(255,80,80,0.25); border: 1px solid rgba(255,80,80,0.5); }

  #mobile-menu-dropdown { display: none; background: rgba(20, 20, 40, 0.95); border-radius: 8px; padding: 6px; border: 1px solid var(--brand-30); width: 100%; gap: 6px; flex-direction: column; margin-top: 6px; }
  #mobile-menu-dropdown.active { display: flex; }
  #stats-dropdown { display: none; background: rgba(20,20,40,0.95); border-radius: 8px; padding: 10px; border: 1px solid rgba(163,103,177,0.3); width: 100%; max-width: 280px; position: absolute; top: 100%; left: 0; margin-top: 6px; z-index: 1000; }
  #stats-dropdown.active { display: block; }
  .stats-item { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(163,103,177,0.2); font-size: 11px; font-weight: 600; color: #E8ECEB; }
  .stats-item:last-child { border-bottom: none; }
  .stats-value { color: #FFD1E3; font-weight: 700; }

  #quicklinks-dropdown { display: none; background: rgba(20,20,40,0.95); border-radius: 8px; padding: 8px; border: 1px solid rgba(163,103,177,0.3); width: 260px; position: absolute; top: 100%; right: 0; margin-top: 6px; z-index: 1000; }
  #quicklinks-dropdown.active { display: block; }
  .quicklink-item { display: block; padding: 8px 10px; color: #fff; text-decoration: none; font-size: 12px; font-weight: 600; border-radius: 6px; transition: all 0.2s ease; }
  .quicklink-item:hover { background: rgba(163,103,177,0.4); }

  #notebookPanel { position: fixed; top: var(--header-height); right: -420px; width: 400px; height: calc(100vh - var(--header-height) - var(--footer-height)); background: #FFD1E3; box-shadow: -4px 0 20px rgba(0,0,0,0.2); z-index: 10000; transition: right 0.3s ease; display: flex; flex-direction: column; }
  #notebookPanel.open { right: 0; }
  .notebook-header { background: var(--panel); padding: 16px; display: flex; justify-content: space-between; align-items: center; }
  .notebook-header h3 { margin: 0; color: #fff; font-size: 16px; }
  .notebook-close { background: rgba(255,255,255,0.2); border: none; color: #fff; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 16px; }
  .notebook-close:hover { background: rgba(255,255,255,0.3); }
  .notebook-body { flex: 1; padding: 16px; display: flex; flex-direction: column; }
  #notebookArea { flex: 1; width: 100%; border: 2px solid var(--panel); border-radius: 8px; padding: 12px; font-family: 'Aptos', sans-serif; font-size: 14px; resize: none; background: #fff; color: #1A1A1A; }
  #notebookArea:focus { outline: none; border-color: #8A4F9F; }
  .notebook-footer { padding: 12px 16px; background: rgba(163,103,177,0.1); font-size: 11px; color: #666; text-align: center; }

  #chat-body { flex: 1; padding: 14px; overflow-y: auto; font-size: 14px; scroll-behavior: smooth; }
  #chat-body::-webkit-scrollbar { width: 5px; }
  #chat-body::-webkit-scrollbar-thumb { background: var(--brand-30); border-radius: 3px; }
  #chat-footer { display: flex; flex-direction: column; gap: 10px; padding: 14px; background: rgba(35,45,65,0.9); border-top: 1px solid rgba(255,255,255,0.1); }
  #test-info { display: none; justify-content: space-between; align-items: center; padding: 6px 10px; background: rgba(163,103,177,0.2); border-radius: 8px; border: 1px solid rgba(163,103,177,0.3); }
  .info-item { display: flex; align-items: center; gap: 5px; font-size: 12px; font-weight: 600; color: #FFD1E3; }
  #timer { color: #FFD1E3; font-size: 14px; font-weight: 700; }
  #word-count { color: #FFD1E3; font-size: 14px; font-weight: 700; }
  #input-area { display: flex; gap: 10px; align-items: stretch; }
  .button-row { display: flex; gap: 10px; }
  #chat-input { flex: 1; resize: none; height: 50px; border-radius: 12px; background: rgba(42,42,61,.8); color: #fff; padding: 10px; font-size: 14px; border: 2px solid var(--brand-35); font-family: 'Aptos', sans-serif; }
  #chat-input:focus { outline: none; border-color: var(--panel); box-shadow: 0 0 12px var(--brand-30); }
  #chat-send, #chat-refine, #chat-skip { border-radius: 12px; background: var(--brand); color: #000; padding: 0 16px; font-weight: 600; cursor: pointer; border: none; transition: all .2s ease; font-family: 'Aptos', sans-serif; font-size: 14px; }
  #chat-send:hover, #chat-refine:hover { filter: brightness(.92); transform: translateY(-2px); }
  #chat-skip { background: rgba(163,103,177,0.4); color: #fff; border: 1px solid rgba(163,103,177,0.6); display: none; }
  #chat-skip:hover { background: rgba(163,103,177,0.6); }
  #chat-skip.active { display: block; }

  .chat-message { display: flex; align-items: flex-end; gap: 8px; margin: 8px 0; animation: fadeInUp .4s ease forwards; }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .chat-message.bot { justify-content: flex-start; text-align: left; }
  .chat-message.user { display: flex; flex-direction: row; justify-content: flex-end; align-items: flex-end; margin-left: auto; text-align: right; gap: 8px; }
  .chat-message.bot .chat-bubble { background: linear-gradient(135deg,#FFD1E3,#FFE0EC); color: #1A1A1A; border-radius: 16px 16px 16px 5px; padding: 10px 14px; line-height: 1.4; max-width: 80%; display: inline-block; box-shadow: 0 2px 8px rgba(0,0,0,0.1); word-wrap: break-word; font-size: 13px; }
  .chat-message.user .chat-bubble { background: linear-gradient(135deg,#8A4F9F,#9B5FAF); color: #fff; border-radius: 16px 16px 5px 16px; padding: 10px 14px; line-height: 1.4; max-width: 80%; display: inline-block; box-shadow: 0 2px 8px rgba(0,0,0,0.15); word-wrap: break-word; text-align: left; font-size: 13px; }
  .chat-message img.avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; margin-bottom: 2px; border: 2px solid var(--brand-30); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

  .side-panel { flex: .7; display: flex; flex-direction: column; align-items: center; height: 580px; gap: 10px; }
  .avatar-box { width: 100%; border-radius: var(--radius); overflow: hidden; }
  .avatar-box img { width: 100%; height: auto; display: block; }
  .faq-box { flex: 1; width: 100%; overflow-y: auto; padding: 14px; background: rgba(20,20,40,.95); border-radius: var(--radius); color: #fff; display: flex; flex-direction: column; gap: 8px; }
  .faq-box::-webkit-scrollbar { width: 5px; }
  .faq-box::-webkit-scrollbar-thumb { background: var(--panel); border-radius: 3px; }
  .faq-box h3 { font-size: 11px; font-weight: 700; color: #FFD1E3; text-transform: uppercase; margin: 10px 0 6px 0; letter-spacing: 0.5px; }
  .faq-box h3:first-child { margin-top: 0; }

  .folder-header { background: rgba(42,42,61,0.85); color: #fff; border-radius: 11px; padding: 10px 12px; font-size: 12px; font-weight: 700; cursor: pointer; border: 2px solid rgba(163,103,177,0.35); transition: all 0.2s ease; display: flex; justify-content: space-between; align-items: center; user-select: none; }
  .folder-header:hover { background: rgba(163,103,177,0.3); border-color: var(--panel); transform: translateX(3px); }
  .folder-header .arrow { transition: transform 0.3s ease; font-size: 10px; }
  .folder-header.open .arrow { transform: rotate(90deg); }
  .test-list { display: none; padding-left: 6px; margin-top: 3px; }
  .test-list.open { display: block !important; }
  .sub-test-list { display: none; padding-left: 10px; margin-top: 3px; }
  .sub-test-list.open { display: block !important; }
  .sub-folder-header { background: rgba(60,60,80,0.75); color: #FFD1E3; border-radius: 8px; padding: 6px 10px; font-size: 11px; font-weight: 600; cursor: pointer; border: 1px solid rgba(163,103,177,0.25); transition: all 0.2s ease; display: flex; justify-content: space-between; align-items: center; margin: 5px 0; user-select: none; }
  .sub-folder-header:hover { background: rgba(80,80,100,0.85); border-color: rgba(163,103,177,0.4); transform: translateX(2px); }
  .sub-folder-header .arrow { transition: transform 0.3s ease; font-size: 9px; }
  .sub-folder-header.open .arrow { transform: rotate(90deg); }
  .test-btn { background: rgba(42,42,61,0.85); color: #fff; border-radius: 8px; padding: 6px 10px; font-size: 11px; text-align: left; cursor: pointer; border: 2px solid rgba(163,103,177,0.35); transition: all 0.2s ease; font-family: 'Aptos', sans-serif; font-weight: 600; margin: 3px 0; display: block; width: 100%; }
  .test-btn:hover { background: rgba(163,103,177,0.3); border-color: var(--panel); transform: translateX(3px); }
  .ns-btn { background: rgba(42,42,61,0.85); color: #fff; border-radius: 11px; padding: 8px 10px; font-size: 12px; text-align: left; cursor: pointer; border: 2px solid var(--brand-35); transition: all .2s ease; font-family: 'Aptos', sans-serif; font-weight: 600; display: block; width: 100%; }
  .ns-btn:hover { background: var(--brand-30); border-color: var(--panel); transform: translateX(3px); }

  .login-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.65); display: flex; justify-content: center; align-items: center; z-index: 20000; }
  .login-overlay.hidden { display: none; }
  .login-modal { background: #ffffff; padding: 24px; width: 320px; border-radius: 16px; text-align: center; box-shadow: 0 8px 40px rgba(0,0,0,0.25); font-family: 'Aptos', sans-serif; }
  .login-modal h2 { font-size: 20px; margin: 0 0 8px 0; color: #000; }
  .login-desc { font-size: 13px; margin-bottom: 16px; color: #333; }
  .login-modal .login-input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #bbb; font-size: 13px; margin-bottom: 14px; box-sizing: border-box; font-family: 'Aptos', sans-serif; }
  .login-submit { width: 100%; padding: 10px; background: var(--panel); color: #fff; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-bottom: 12px; font-family: 'Aptos', sans-serif; font-size: 14px; }
  .login-submit:hover { filter: brightness(0.92); }
  .login-close { width: 100%; padding: 8px; background: #ddd; border: none; border-radius: 6px; cursor: pointer; font-family: 'Aptos', sans-serif; font-size: 13px; }
  .login-close:hover { background: #ccc; }
  .login-status { margin-top: 8px; font-size: 13px; color: #333; min-height: 18px; }

  .logged-in-bar { display: none; background: rgba(80,200,120,0.2); border: 1px solid rgba(80,200,120,0.5); border-radius: 6px; padding: 6px 10px; font-size: 11px; color: #90EE90; text-align: center; }
  .logged-in-bar.active { display: block; }

  @media (max-width:1024px) {
    html, body { height: auto !important; min-height: 100vh !important; overflow-y: auto !important; overflow-x: hidden !important; }
    .mn-header-outer.evolve-header { flex-direction: column !important; height: auto !important; padding: 14px 10px !important; position: relative !important; }
    .mn-header-inner { flex-direction: column !important; gap: 12px !important; }
    .mn-logo img { height: 45px !important; }
    .mn-nav { gap: 8px !important; flex-wrap: wrap !important; justify-content: center !important; }
    .nav-tile { padding: 6px 12px !important; min-width: 100px !important; }
    .nav-tile .nav-name { font-size: 14px !important; }
    .nav-tile .nav-desc { font-size: 9px !important; }
    #main-content-area { position: static !important; padding: 30px 8px 25px 8px !important; overflow: visible !important; }
    .contrast-panel { padding: 10px; max-width: 100%; width: 100%; }
    .ns-grid { flex-direction: column; align-items: center; gap: 10px; }
    .side-panel { display: contents; }
    .avatar-box { max-width: 400px; margin: 0 auto 20px auto; order: 1 !important; }
    .chat-box { width: 100%; height: 600px !important; min-height: 600px !important; max-height: 600px !important; margin-bottom: 25px !important; order: 2 !important; }
    .faq-box { width: 100%; height: 600px !important; min-height: 600px !important; max-height: 600px !important; margin-bottom: 42px !important; order: 3 !important; }
    #progress-container { padding: 6px !important; gap: 8px !important; }
    .desktop-actions { display: none !important; }
    .mobile-actions { display: flex !important; }
    #chat-footer { flex-direction: column !important; gap: 10px !important; padding: 12px !important; }
    #input-area { flex-direction: column !important; gap: 10px !important; }
    #chat-input { width: 100% !important; height: 80px !important; font-size: 16px !important; }
    .button-row { display: flex !important; gap: 10px !important; width: 100% !important; }
    #chat-send, #chat-refine, #chat-skip { flex: 1 !important; padding: 12px !important; height: 48px !important; font-size: 15px !important; }
    .mn-footer { position: relative !important; padding: 15px 0 !important; height: auto !important; }
    .mn-footer-inner { flex-direction: column !important; gap: 8px !important; text-align: center; }
    #notebookPanel { width: 100%; right: -100%; }
    #notebookPanel.open { right: 0; }
    #quicklinks-dropdown { right: -100px; width: 260px; }
  }
</style>
</head>
<body>

<div class="mn-header-outer evolve-header">
  <div class="mn-header-inner">
    <div class="mn-logo"><a href="/"><img src="https://migratenorth.ca/wp-content/uploads/2025/11/matin-logo-1-1.png" alt="Logo"></a></div>
    <nav class="mn-nav">
      <a href="/evolve" class="nav-tile active"><span class="nav-name">Evolve</span><span class="nav-desc">Language Proficiency</span></a>
      <a href="/elevate" class="nav-tile"><span class="nav-name">Elevate</span><span class="nav-desc">Nursing & Licensing Path</span></a>
      <a href="/execute" class="nav-tile"><span class="nav-name">Execute</span><span class="nav-desc">Immigration File Support</span></a>
    </nav>
  </div>
</div>

<div id="main-content-area">
  <div class="contrast-panel">
    <div class="ns-grid">
      <div class="chat-box" id="chatbox">
        <div id="progress-container">
          <div class="action-buttons-bar desktop-actions">
            <button class="action-btn" id="btn-stats">üìä Stats</button>
            <button class="action-btn" id="btn-download">üì• Download</button>
            <button class="action-btn" id="btn-notebook">üìì Notebook</button>
            <button class="action-btn" id="btn-quicklinks">üîó Resources</button>
            <button class="action-btn danger" id="btn-reset">‚ôªÔ∏è Reset</button>
            <button class="action-btn" id="btn-login">Login</button>
          </div>
          <div class="action-buttons-bar mobile-actions"><button class="action-btn" id="btn-mobile-menu">‚ò∞ Menu</button></div>
          <div id="mobile-menu-dropdown">
            <button class="action-btn-inner" id="btn-stats-mobile">üìä Stats</button>
            <button class="action-btn-inner" id="btn-download-mobile">üì• Download</button>
            <button class="action-btn-inner" id="btn-notebook-mobile">üìì Notebook</button>
            <button class="action-btn-inner" id="btn-quicklinks-mobile">üîó Resources</button>
            <button class="action-btn-inner danger" id="btn-reset-mobile">‚ôªÔ∏è Reset</button>
            <button class="action-btn-inner" id="btn-login-mobile">Login</button>
          </div>
          <div class="logged-in-bar" id="logged-in-bar">‚úì Logged in as <span id="logged-in-email"></span></div>
          <div id="stats-dropdown">
            <div class="stats-item"><span>Total Tests:</span><span class="stats-value" id="stat-tests">0/66</span></div>
            <div class="stats-item"><span>Writing:</span><span class="stats-value" id="stat-writing">0</span></div>
            <div class="stats-item"><span>Reading:</span><span class="stats-value" id="stat-reading">0</span></div>
            <div class="stats-item"><span>Micro Drills:</span><span class="stats-value" id="stat-micro">0</span></div>
            <div class="stats-item"><span>Avg Speed:</span><span class="stats-value" id="stat-speed">-- WPM</span></div>
            <div class="stats-item"><span>Accuracy Trend:</span><span class="stats-value" id="stat-accuracy">--%</span></div>
            <div class="stats-item"><span>Streak:</span><span class="stats-value" id="stat-streak">0 days</span></div>
            <div class="stats-item"><span>Practice Time:</span><span class="stats-value" id="stat-time">0 min</span></div>
          </div>
          <div id="quicklinks-dropdown">
            <a href="https://www.canada.ca/en/immigration-refugees-citizenship/services/immigrate-canada/express-entry.html" target="_blank" class="quicklink-item">üçÅ IRCC Express Entry</a>
            <a href="https://www.canada.ca/en/immigration-refugees-citizenship/services/application/account.html" target="_blank" class="quicklink-item">üçÅ IRCC Account Portal</a>
            <a href="https://www.wes.org/ca/" target="_blank" class="quicklink-item">üìú WES Canada</a>
            <a href="https://www.ielts.org/" target="_blank" class="quicklink-item">üìù IELTS Official</a>
            <a href="https://www.celpip.ca/" target="_blank" class="quicklink-item">üìù CELPIP Official</a>
            <a href="https://www.nnas.ca/" target="_blank" class="quicklink-item">üè• NNAS for Nurses</a>
            <a href="https://www.jobbank.gc.ca/" target="_blank" class="quicklink-item">üíº Job Bank Canada</a>
          </div>
        </div>
        <div id="chat-body"></div>
        <div id="chat-footer">
          <div id="test-info">
            <div class="info-item"><span>Time:</span><span id="timer">--:--</span></div>
            <div class="info-item"><span>Words:</span><span id="word-count">0</span></div>
          </div>
          <div id="input-area">
            <textarea id="chat-input" placeholder="Login required to use Evolve" disabled></textarea>
            <div class="button-row">
              <button id="chat-send" disabled>Submit</button>
              <button id="chat-refine" disabled>Refine</button>
              <button id="chat-skip">Skip ‚è≠Ô∏è</button>
            </div>
          </div>
        </div>
      </div>
      <div class="side-panel">
        <div class="avatar-box"><img src="https://migratenorth.ca/wp-content/uploads/2025/11/Gemini_Generated_Image_xe229lxe229lxe22-2.png" alt="Avatar"></div>
        <div id="faq-dashboard" class="faq-box">
          <h3>Start Here</h3>
          <button class="ns-btn" data-faq="how-bootcamp-works">How the Academy Works</button>
          <button class="ns-btn" data-faq="how-dashboard">How to Use This Dashboard</button>
          
          <h3>NorthStar GPS</h3>
          <button class="ns-btn" data-faq="speed-tips">Tips for Writing Faster</button>
          <button class="ns-btn" data-faq="accuracy-tips">Tips for Better Accuracy</button>
          <button class="ns-btn" data-faq="vocab-tips">How to Learn New Words</button>
          <button class="ns-btn" data-faq="grammar-rules">Rules of Grammar</button>
          <button class="ns-btn" data-faq="common-mistakes">Common Mistakes to Avoid</button>
          <button class="ns-btn" data-faq="essay-structure">How to Structure an Essay</button>
          <button class="ns-btn" data-faq="reading-analysis">How to Analyze a Reading Passage</button>
          
          <h3>Writing Practice</h3>
          <div class="folder-header" data-folder="writing"><span>Open Writing</span><span class="arrow">‚ñ∫</span></div>
          <div class="test-list" id="writing-tests">
            <div class="sub-folder-header" data-subfolder="writing-foundation"><span>Foundation (1-11)</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="writing-foundation-tests"></div>
            <div class="sub-folder-header" data-subfolder="writing-intermediate"><span>Intermediate (12-22)</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="writing-intermediate-tests"></div>
            <div class="sub-folder-header" data-subfolder="writing-advanced"><span>Advanced (23-33)</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="writing-advanced-tests"></div>
            <div class="sub-folder-header" data-subfolder="writing-micro"><span>Micro Drills</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="writing-micro-tests"></div>
            <button class="ns-btn" data-faq="random-writing">üé≤ Random Writing Test</button>
            <button class="ns-btn" data-faq="sample-answers">üìÑ Sample High-Scoring Responses</button>
          </div>
          
          <h3>Reading Practice</h3>
          <div class="folder-header" data-folder="reading"><span>Open Reading</span><span class="arrow">‚ñ∫</span></div>
          <div class="test-list" id="reading-tests">
            <div class="sub-folder-header" data-subfolder="reading-foundation"><span>Foundation (1-11)</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="reading-foundation-tests"></div>
            <div class="sub-folder-header" data-subfolder="reading-intermediate"><span>Intermediate (12-22)</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="reading-intermediate-tests"></div>
            <div class="sub-folder-header" data-subfolder="reading-advanced"><span>Advanced (23-33)</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="reading-advanced-tests"></div>
            <div class="sub-folder-header" data-subfolder="reading-micro"><span>Micro Drills</span><span class="arrow">‚ñ∫</span></div>
            <div class="sub-test-list" id="reading-micro-tests"></div>
            <button class="ns-btn" data-faq="random-reading">üé≤ Random Reading Test</button>
          </div>
          
          <h3>Vocabulary Builder</h3>
          <button class="ns-btn" data-faq="vocab-drill">Start Vocabulary Drill</button>
          <button class="ns-btn" data-faq="vocab-review">Review My Words</button>
          <button class="ns-btn" data-faq="word-list">Academic Word List Overview</button>
          
          <h3>My Progress</h3>
          <button class="ns-btn" data-faq="progress-overview">My Progress Overview</button>
          <button class="ns-btn" id="btn-new-test">Start New Test</button>
          
          <h3>Scoring Explained</h3>
          <button class="ns-btn" data-faq="ielts-writing-scoring">IELTS Writing Scoring</button>
          <button class="ns-btn" data-faq="ielts-reading-scoring">IELTS Reading Scoring</button>
          <button class="ns-btn" data-faq="celpip-writing-scoring">CELPIP Writing Scoring</button>
          <button class="ns-btn" data-faq="celpip-reading-scoring">CELPIP Reading Scoring</button>
          <button class="ns-btn" data-faq="score-conversion">IELTS CELPIP to CLB</button>
          
          <h3>Program Information</h3>
          <button class="ns-btn" data-faq="about">About This Program</button>
          <button class="ns-btn" data-faq="pricing">Pricing and Access</button>
          <button class="ns-btn" data-faq="writing-review">üìù Request Writing Review</button>
          <button class="ns-btn pay-btn" id="unlock-evolve">Unlock Full Evolve Access</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Notebook Panel -->
<div id="notebookPanel">
  <div class="notebook-header">
    <h3>üìì My Notebook</h3>
    <button class="notebook-close" id="notebook-close">‚úï</button>
  </div>
  <div class="notebook-body">
    <textarea id="notebookArea" placeholder="Take notes during your training sessions..."></textarea>
  </div>
  <div class="notebook-footer">Auto-saved to your browser</div>
</div>

<!-- Login Modal -->
<div id="login-overlay" class="login-overlay hidden">
  <div class="login-modal">
    <h2>Login to Evolve</h2>
    <p class="login-desc">Enter your email to check your subscription.</p>
    <input type="email" id="login-email" placeholder="you@example.com" class="login-input">
    <button id="login-submit" class="login-submit">Check Access</button>
    <div id="login-status" class="login-status"></div>
    <button id="login-close" class="login-close">Close</button>
  </div>
</div>

<footer class="mn-footer">
  <div class="mn-footer-inner">
    <div class="footer-left">
      <a href="https://college-ic.ca/" target="_blank"><img src="https://migratenorth.ca/wp-content/uploads/2025/09/WhatsApp-Image-2025-04-03-at-16.37.27-2.jpeg" alt="RCIC"></a>
      <a class="license-number" href="https://college-ic.ca/protecting-the-public/find-an-immigration-consultant" target="_blank">RCIC License #R712582</a>
    </div>
    <div class="footer-center"><a class="footer-email" href="mailto:info@migratenorth.ca">info@migratenorth.ca</a></div>
    <div class="footer-right">
      <span>¬© 2025 Migrate North Academy</span>
      <span>Results depend on consistent practice.</span>
    </div>
  </div>
</footer>

<script>
// =============================================================================
// CONFIGURATION
// =============================================================================
const API_BASE = "https://startling-faun-f9dddb.netlify.app";
const PAYMENT_LINKS = { 
  evolve: 'https://migratenorth.ca/checkout/evolve', 
  elevate: 'https://migratenorth.ca/checkout/elevate', 
  execute: 'https://migratenorth.ca/checkout/execute' 
};

// =============================================================================
// FAQ CONTENT - Real answers for all FAQ buttons
// =============================================================================
const FAQ_CONTENT = {
  "how-bootcamp-works": `Welcome to Migrate North Academy's Evolve Program!

This is your IELTS and CELPIP training center. Here's how it works:

1. **66 Progressive Tests** - Writing and Reading tests organized by difficulty (Foundation ‚Üí Intermediate ‚Üí Advanced)

2. **Micro Drills** - Targeted practice for specific skills like paraphrasing, grammar control, and reading comprehension

3. **AI-Powered Feedback** - Submit your answers and receive instant scoring with detailed feedback on grammar, vocabulary, coherence, and task achievement

4. **Vocabulary Builder** - Learn and review high-frequency academic words

5. **Track Your Progress** - Your stats are saved so you can see improvement over time (accuracy trend, practice time, streak)

Start with Foundation tests and work your way up. Consistency is key - aim for at least one test per day!`,

  "how-dashboard": `How to Use This Dashboard:

**Top Bar Controls:**
‚Ä¢ üìä Stats - View your progress, accuracy trend, and practice time
‚Ä¢ üì• Download - Export your results
‚Ä¢ üìì Notebook - Take notes during training
‚Ä¢ üîó Resources - Quick links to official sites
‚Ä¢ ‚ôªÔ∏è Reset - Clear the chat
‚Ä¢ Login/Logout - Manage your session

**Right Panel:**
‚Ä¢ Select tests from Writing or Reading folders
‚Ä¢ Try Micro Drills for targeted skill practice
‚Ä¢ Use Vocabulary Builder to expand your word bank
‚Ä¢ Click folder headers to expand/collapse
‚Ä¢ Foundation ‚Üí Intermediate ‚Üí Advanced progression

**Chat Area:**
‚Ä¢ Receive test prompts here
‚Ä¢ Type your answers in the input box
‚Ä¢ Click Submit to send for AI evaluation
‚Ä¢ Click Refine to get improvement suggestions
‚Ä¢ Use Skip to move to next question during typing`,

  "speed-tips": `Tips for Writing Faster:

1. **Plan Before Writing** - Spend 2-3 minutes outlining your main points
2. **Use Templates** - Memorize paragraph structures for common question types
3. **Don't Overthink** - Write your first thought, refine later
4. **Practice Typing** - Your typing speed directly affects test performance
5. **Time Yourself** - Always practice with a timer
6. **Learn Transitions** - Keep a mental list of linking words ready
7. **Skip Difficult Words** - Use simpler synonyms to maintain flow
8. **Review Last** - Focus on completing first, editing second`,

  "accuracy-tips": `Tips for Better Accuracy:

1. **Read Questions Twice** - Understand exactly what's being asked
2. **Answer All Parts** - Multi-part questions need complete responses
3. **Check Subject-Verb Agreement** - Common error that costs marks
4. **Vary Sentence Structure** - Mix simple, compound, and complex sentences
5. **Use Specific Examples** - General statements need concrete support
6. **Proofread Systematically** - Check spelling, grammar, then content
7. **Stay On Topic** - Every sentence should relate to the question
8. **Count Your Words** - Stay within the required range`,

  "vocab-tips": `How to Learn New Words Effectively:

1. **Learn in Context** - Study words within sentences, not isolation
2. **Use Spaced Repetition** - Review words at increasing intervals
3. **Create Word Families** - Learn related forms (decide, decision, decisive)
4. **Practice Collocations** - Learn which words go together naturally
5. **Read Widely** - Expose yourself to academic and news articles
6. **Keep a Vocabulary Journal** - Write new words in your notebook
7. **Use Words Actively** - Incorporate new vocabulary in your writing
8. **Focus on High-Frequency Academic Words** - Prioritize the AWL list`,

  "grammar-rules": `Essential Grammar Rules for IELTS/CELPIP:

**Tenses:**
‚Ä¢ Use present simple for facts and habits
‚Ä¢ Use present perfect for experiences and recent events
‚Ä¢ Use past simple for completed actions with time markers

**Articles:**
‚Ä¢ 'The' for specific/known items
‚Ä¢ 'A/An' for general/first mention
‚Ä¢ No article for general plurals and uncountables

**Common Structures:**
‚Ä¢ Conditionals (If + present, will + verb)
‚Ä¢ Passive voice (is/are/was/were + past participle)
‚Ä¢ Relative clauses (who, which, that, where)

**Punctuation:**
‚Ä¢ Commas after introductory phrases
‚Ä¢ No comma before 'that' in essential clauses
‚Ä¢ Semicolons between related independent clauses`,

  "common-mistakes": `Common Mistakes to Avoid:

1. **Run-on Sentences** - Use periods or conjunctions to separate ideas
2. **Word Repetition** - Use synonyms to show vocabulary range
3. **Off-Topic Content** - Every paragraph must address the question
4. **Informal Language** - Avoid contractions, slang, and "etc."
5. **Overuse of "I think"** - Vary opinion expressions
6. **Missing Conclusions** - Always end with a summary or final thought
7. **Copying Question Words** - Paraphrase the prompt in your answer
8. **Ignoring Word Count** - Under 250 words in Task 2 loses marks
9. **No Paragraphing** - Use clear paragraph breaks
10. **Forgetting Examples** - Support all claims with specifics`,

  "progress-overview": `Your Progress Overview:

Check the üìä Stats button for your full statistics including:

‚Ä¢ **Total tests completed** out of 66
‚Ä¢ **Writing vs Reading** breakdown
‚Ä¢ **Micro Drills** completed
‚Ä¢ **Average words per minute** (WPM)
‚Ä¢ **Accuracy Trend** - Are you improving over time?
‚Ä¢ **Current streak** - Consecutive practice days
‚Ä¢ **Practice Time** - Total minutes spent training

**How Stats Work:**
Your stats update automatically as you complete tests. Start with zeros, watch them grow!

**Tips for Improvement:**
‚Ä¢ Aim to complete at least 1 test daily
‚Ä¢ Review your weakest areas in Micro Drills
‚Ä¢ Retake tests where you scored below 6.0
‚Ä¢ Track your accuracy trend over time
‚Ä¢ Build a streak for consistent practice

Keep practicing consistently - improvement comes with repetition!`,

  "ielts-writing-scoring": `IELTS Writing Scoring (Band Descriptors):

**Task Achievement (25%)**
‚Ä¢ Band 7+: Fully addresses all parts, clear position
‚Ä¢ Band 6: Addresses task, but may lack focus
‚Ä¢ Band 5: Only partially addresses the task

**Coherence & Cohesion (25%)**
‚Ä¢ Band 7+: Logical organization, clear progression
‚Ä¢ Band 6: Generally coherent, some issues
‚Ä¢ Band 5: Lacks overall progression

**Lexical Resource (25%)**
‚Ä¢ Band 7+: Wide vocabulary range, few errors
‚Ä¢ Band 6: Adequate vocabulary, some errors
‚Ä¢ Band 5: Limited range, noticeable errors

**Grammar Range & Accuracy (25%)**
‚Ä¢ Band 7+: Variety of structures, few errors
‚Ä¢ Band 6: Mix of structures, some errors
‚Ä¢ Band 5: Limited range, frequent errors

**Target: Band 7 = CLB 9**`,

  "celpip-writing-scoring": `CELPIP Writing Scoring:

**Level 9-10 (Advanced)**
‚Ä¢ Sophisticated vocabulary and grammar
‚Ä¢ Fully developed ideas with examples
‚Ä¢ Excellent organization and flow
‚Ä¢ Minimal errors

**Level 7-8 (Adequate to Good)**
‚Ä¢ Good vocabulary range
‚Ä¢ Clear organization
‚Ä¢ Well-developed content
‚Ä¢ Some minor errors

**Level 5-6 (Developing)**
‚Ä¢ Basic vocabulary
‚Ä¢ Simple sentence structures
‚Ä¢ Ideas present but underdeveloped
‚Ä¢ Noticeable errors

**Level 3-4 (Limited)**
‚Ä¢ Very basic communication
‚Ä¢ Frequent errors affecting meaning
‚Ä¢ Incomplete ideas

**Target: Level 9 = CLB 9**`,

  "score-conversion": `IELTS & CELPIP to CLB Conversion:

**CLB 10:**
‚Ä¢ IELTS: 8.0-9.0
‚Ä¢ CELPIP: 10-12

**CLB 9:**
‚Ä¢ IELTS: 7.0-7.5
‚Ä¢ CELPIP: 9

**CLB 8:**
‚Ä¢ IELTS: 6.5
‚Ä¢ CELPIP: 8

**CLB 7:**
‚Ä¢ IELTS: 6.0
‚Ä¢ CELPIP: 7

**CLB 6:**
‚Ä¢ IELTS: 5.5
‚Ä¢ CELPIP: 6

**CLB 5:**
‚Ä¢ IELTS: 5.0
‚Ä¢ CELPIP: 5

**Express Entry Points:**
‚Ä¢ CLB 9+ all abilities: 124 points (first language)
‚Ä¢ CLB 7 all abilities: 64 points
‚Ä¢ Higher CLB = More CRS points!`,

  "about": `About Migrate North Academy - Evolve:

**What is Evolve?**
Evolve is an AI-powered language training platform designed specifically for Canadian immigration applicants preparing for IELTS and CELPIP exams.

**Created By:**
Matin Immigration Services Inc.
RCIC License #R712582

**What's Included:**
‚Ä¢ 66 progressive writing and reading tests
‚Ä¢ Micro Drills for targeted skill practice
‚Ä¢ Vocabulary Builder with academic word lists
‚Ä¢ AI-powered instant feedback and scoring
‚Ä¢ Progress tracking (accuracy trend, practice time, streak)
‚Ä¢ Personal notebook
‚Ä¢ Quick links to official resources

**Our Mission:**
To help immigrants achieve their required language scores efficiently and affordably, supporting their journey to Canadian permanent residence.

**Contact:** info@migratenorth.ca`,

  "pricing": `Evolve Pricing and Access:

**Full Access Includes:**
‚úì All 66 Writing & Reading Tests
‚úì All Micro Drills (12 skill categories)
‚úì Vocabulary Builder & Word Lists
‚úì AI-Powered Scoring & Feedback
‚úì Unlimited Practice Sessions
‚úì Progress Tracking Dashboard
‚úì Personal Notebook
‚úì Mobile-Friendly Access

**Subscription Options:**
‚Ä¢ Monthly Access
‚Ä¢ Quarterly Access (Best Value)
‚Ä¢ Annual Access

**Bundle Deals:**
Combine Evolve with Execute (immigration file support) or Elevate (nursing pathway) for additional savings.

Click the yellow "Unlock Full Evolve Access" button below to see current pricing and subscribe.

**Satisfaction Guarantee:**
We're confident in our platform. Contact us if you have any concerns.`,

  "essay-structure": `How to Structure an Essay (IELTS Task 2 / CELPIP):

**Introduction (2-3 sentences)**
‚Ä¢ Paraphrase the question
‚Ä¢ State your position clearly
‚Ä¢ Preview your main points (optional)

**Body Paragraph 1 (5-7 sentences)**
‚Ä¢ Topic sentence stating main idea
‚Ä¢ Explanation of the point
‚Ä¢ Specific example or evidence
‚Ä¢ Link back to thesis

**Body Paragraph 2 (5-7 sentences)**
‚Ä¢ Topic sentence (different angle)
‚Ä¢ Explanation
‚Ä¢ Example/evidence
‚Ä¢ Link to argument

**Conclusion (2-3 sentences)**
‚Ä¢ Restate your position (different words)
‚Ä¢ Summarize key points
‚Ä¢ Final thought or recommendation

**Word Count Target:** 250-280 words
**Time Management:** Plan 5 min, Write 30 min, Review 5 min`,

  "reading-analysis": `How to Analyze a Reading Passage:

**First Read (2-3 minutes):**
‚Ä¢ Skim for main idea and structure
‚Ä¢ Note paragraph topics
‚Ä¢ Don't read every word

**Question Strategy:**
‚Ä¢ Read questions BEFORE detailed reading
‚Ä¢ Identify question types (detail, inference, main idea)
‚Ä¢ Note keywords to search for

**Finding Answers:**
‚Ä¢ Scan for keywords from the question
‚Ä¢ Read surrounding sentences carefully
‚Ä¢ Watch for paraphrased information

**Common Question Types:**
‚Ä¢ True/False/Not Given - Match to exact text
‚Ä¢ Multiple Choice - Eliminate wrong answers
‚Ä¢ Matching - Use headings as guides
‚Ä¢ Fill in Blanks - Check grammar fit

**Time Management:**
‚Ä¢ Spend 20 minutes per passage
‚Ä¢ Don't get stuck on one question
‚Ä¢ Mark difficult ones and return later`,

  "ielts-reading-scoring": `IELTS Reading Scoring:

**Band Score = Correct Answers out of 40**

‚Ä¢ Band 9: 39-40 correct
‚Ä¢ Band 8.5: 37-38 correct
‚Ä¢ Band 8: 35-36 correct
‚Ä¢ Band 7.5: 33-34 correct
‚Ä¢ Band 7: 30-32 correct
‚Ä¢ Band 6.5: 27-29 correct
‚Ä¢ Band 6: 23-26 correct
‚Ä¢ Band 5.5: 19-22 correct
‚Ä¢ Band 5: 15-18 correct

**Key Strategies:**
‚Ä¢ No negative marking - always guess
‚Ä¢ Spelling must be exact
‚Ä¢ Follow word limits strictly
‚Ä¢ Transfer answers carefully

**Time Management:**
‚Ä¢ 60 minutes for 40 questions
‚Ä¢ ~20 minutes per passage
‚Ä¢ Save 5 minutes for answer transfer`,

  "celpip-reading-scoring": `CELPIP Reading Scoring:

**Level 9-10 (Advanced)**
‚Ä¢ Understands complex texts fully
‚Ä¢ Identifies subtle nuances and implications
‚Ä¢ Handles academic/professional material easily

**Level 7-8 (Adequate to Good)**
‚Ä¢ Understands most complex texts
‚Ä¢ Can identify main ideas and details
‚Ä¢ Handles most workplace reading

**Level 5-6 (Developing)**
‚Ä¢ Understands simple to moderately complex texts
‚Ä¢ May miss subtle meanings
‚Ä¢ Can handle basic workplace reading

**Test Format:**
‚Ä¢ 4 parts, 38-55 questions
‚Ä¢ 55-60 minutes total
‚Ä¢ Computer-based, multiple choice

**Question Types:**
‚Ä¢ Reading correspondence
‚Ä¢ Reading to apply a diagram
‚Ä¢ Reading for information
‚Ä¢ Reading for viewpoints`,

  "writing-review": `üìù Request Expert Writing Review

Want personalized feedback from a human expert?

Our team offers detailed writing reviews that go beyond AI scoring:

**What You Get:**
‚Ä¢ Line-by-line feedback on your response
‚Ä¢ Specific suggestions for improvement
‚Ä¢ Band score estimate with explanation
‚Ä¢ Personalized study recommendations
‚Ä¢ Response within 48 hours

**How to Request:**
1. Complete a writing test in Evolve
2. Copy your response
3. Email to: **info@migratenorth.ca**
4. Subject line: "Writing Review Request"
5. Include: Your response + the original prompt

**Pricing:**
‚Ä¢ Single review: Contact for quote
‚Ä¢ Package of 5 reviews: Discounted rate
‚Ä¢ Unlimited reviews: Available with premium plans

This service pairs perfectly with your Evolve subscription for maximum improvement!`,

  "random-writing": `üé≤ Random Writing Test

Ready to challenge yourself?

A random writing test will be selected for you based on:
‚Ä¢ Your current progress level
‚Ä¢ Topics you haven't practiced recently
‚Ä¢ Skills that need reinforcement

**Test Format:**
‚Ä¢ Task 2 style essay question
‚Ä¢ 40 minute time limit
‚Ä¢ 250+ word requirement
‚Ä¢ AI scoring on all criteria

Click "Start New Test" to begin a randomly selected writing challenge!

**Pro Tip:** Random tests help simulate real exam conditions where you don't know the topic in advance.`,

  "random-reading": `üé≤ Random Reading Test

Ready for a reading challenge?

A random reading passage will be selected featuring:
‚Ä¢ Varied topics (science, history, society, business)
‚Ä¢ Different question types
‚Ä¢ Appropriate difficulty for your level

**Test Format:**
‚Ä¢ One full reading passage
‚Ä¢ 13-14 questions
‚Ä¢ 20 minute time limit
‚Ä¢ Various question types

Click "Start New Test" to begin a randomly selected reading challenge!

**Pro Tip:** Practice with unfamiliar topics to build adaptive reading skills.`,

  "sample-answers": `üìÑ Sample High-Scoring Responses

Learn from the best! Here's what Band 7+ / Level 9+ writing looks like:

**Key Features of High-Scoring Responses:**

1. **Clear Position** - Thesis stated in introduction
2. **Logical Structure** - Easy to follow paragraph flow
3. **Specific Examples** - Concrete evidence, not vague claims
4. **Varied Vocabulary** - Synonyms, academic words, collocations
5. **Complex Sentences** - Mix of structures without errors
6. **Cohesive Devices** - Smooth transitions between ideas
7. **Full Task Response** - All parts of question addressed

**Access Sample Responses:**
Subscribe to Evolve to unlock our library of:
‚Ä¢ 20+ Band 7-9 IELTS essays
‚Ä¢ 20+ Level 9-10 CELPIP responses
‚Ä¢ Annotated versions showing why they score high
‚Ä¢ Common topics with model answers`,

  "vocab-drill": `üìö Vocabulary Drill

Build your academic vocabulary with targeted practice!

**How It Works:**
1. See a word with definition
2. Use it in a sentence
3. AI checks your usage
4. Word added to your review list

**Word Categories:**
‚Ä¢ Academic Word List (AWL) - 570 essential words
‚Ä¢ IELTS High-Frequency - Top 200 words
‚Ä¢ Topic-Specific - Science, Business, Society
‚Ä¢ Collocations - Word partnerships

**Daily Goal:** Learn 5-10 new words

Start a drill to expand your vocabulary range!`,

  "vocab-review": `üìñ Review My Words

Track and review your vocabulary progress:

**Your Word Bank:**
‚Ä¢ Words learned: View in Stats
‚Ä¢ Words to review: Spaced repetition
‚Ä¢ Mastered words: Used correctly 3+ times

**Review Modes:**
‚Ä¢ Flashcard mode - Quick recall practice
‚Ä¢ Sentence mode - Use in context
‚Ä¢ Quiz mode - Multiple choice

**Tips for Retention:**
‚Ä¢ Review daily for best results
‚Ä¢ Use new words in your writing tests
‚Ä¢ Create personal example sentences
‚Ä¢ Group words by topic

Your vocabulary directly impacts your Lexical Resource score!`,

  "word-list": `üìã Academic Word List Overview

The Academic Word List (AWL) contains 570 word families essential for academic success:

**Sublist 1 (Most Common):**
analyse, approach, area, assess, assume, authority, available, benefit, concept, consist, constitute, context, contract, create, data, define, derive, distribute, economy, environment, establish, estimate, evident, export, factor, finance, formula, function, identify, income, indicate, individual, interpret, involve, issue, labour, legal, legislate, major, method, occur, percent, period, policy, principle, proceed, process, require, research, respond, role, section, sector, significant, similar, source, specific, structure, theory, vary

**Study Strategy:**
‚Ä¢ Learn 10 words per week
‚Ä¢ Focus on word families (vary, variable, variation, varied)
‚Ä¢ Practice in context, not isolation
‚Ä¢ Use in your writing tests

Master the AWL to boost your vocabulary score!`
};

// =============================================================================
// STATE
// =============================================================================
var userIsSubscribed = false;
var currentUserEmail = localStorage.getItem('evolve_user_email') || null;

// =============================================================================
// UTILITIES
// =============================================================================
const Utils = {
  escapeHtml(t) { const d = document.createElement("div"); d.textContent = t; return d.innerHTML; },
  scrollDown() { const e = document.getElementById("chat-body"); if (e) e.scrollTop = e.scrollHeight; }
};

// =============================================================================
// CHAT ENGINE
// =============================================================================
const ChatEngine = {
  interval: null, isTyping: false, skipBtn: null,
  showSkipButton() { if (this.skipBtn) this.skipBtn.classList.add('active'); },
  hideSkipButton() { if (this.skipBtn) this.skipBtn.classList.remove('active'); },
  addBotMessage(t) {
    if (this.isTyping) this.cleanup();
    const b = document.getElementById("chat-body");
    const d = document.createElement("div");
    d.className = "chat-message bot";
    d.innerHTML = '<img class="avatar" src="https://migratenorth.ca/wp-content/uploads/2025/11/Gemini_Generated_Image_xe229lxe229lxe22-2.png"><div class="chat-bubble"></div>';
    b.appendChild(d);
    this.typeWriter(t, d.querySelector(".chat-bubble"));
  },
  typeWriter(t, e) {
    if (this.isTyping) this.cleanup();
    this.isTyping = true;
    let i = 0;
    const c = t.replace(/\r/g, "");
    this.showSkipButton();
    const skipHandler = () => { clearInterval(this.interval); e.innerHTML = c.replace(/\n/g, "<br>").replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>"); this.cleanup(); Utils.scrollDown(); };
    if (this.skipBtn) { this.skipBtn.removeEventListener('click', this.skipBtn._handler); this.skipBtn._handler = skipHandler; this.skipBtn.addEventListener('click', skipHandler); }
    this.interval = setInterval(() => {
      if (i >= c.length) { 
        clearInterval(this.interval); 
        e.innerHTML = e.innerHTML.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
        this.cleanup(); 
        return; 
      }
      if (c.charAt(i) === "\n") {
        e.innerHTML += "<br>";
      } else if (c.charAt(i) === "*" && c.charAt(i+1) === "*") {
        // Skip markdown bold markers during typing
        i++;
      } else {
        e.innerHTML += Utils.escapeHtml(c.charAt(i));
      }
      i++;
      if (i % 50 === 0) Utils.scrollDown();
    }, 12);
  },
  cleanup() { this.hideSkipButton(); if (this.interval) clearInterval(this.interval); this.interval = null; this.isTyping = false; },
  init() { this.skipBtn = document.getElementById('chat-skip'); }
};

// =============================================================================
// ACCESS CONTROL - REAL ENTITLEMENT CHECK
// =============================================================================
async function checkEntitlement(email) {
  console.log("Checking entitlement for:", email);
  try {
    const res = await fetch(API_BASE + "/.netlify/functions/check-entitlement", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: email, product: "evolve" })
    });
    const data = await res.json();
    console.log("Entitlement response:", data);
    return data;
  } catch (err) {
    console.error("Entitlement check failed:", err);
    return { active: false, tier: null };
  }
}

function applyAccess(isActive, email) {
  userIsSubscribed = isActive;
  const input = document.getElementById("chat-input");
  const send = document.getElementById("chat-send");
  const refine = document.getElementById("chat-refine");
  const loginBtn = document.getElementById("btn-login");
  const loginBtnMobile = document.getElementById("btn-login-mobile");
  const loggedInBar = document.getElementById("logged-in-bar");
  const loggedInEmail = document.getElementById("logged-in-email");

  if (isActive) {
    input.disabled = false;
    send.disabled = false;
    if (refine) refine.disabled = false;
    input.placeholder = "Type your answer here...";
    if (loginBtn) loginBtn.textContent = "Logout";
    if (loginBtnMobile) loginBtnMobile.textContent = "Logout";
    if (loggedInBar) loggedInBar.classList.add("active");
    if (loggedInEmail) loggedInEmail.textContent = email;
  } else {
    input.disabled = true;
    send.disabled = true;
    if (refine) refine.disabled = true;
    input.placeholder = "Login required to use Evolve";
    if (loginBtn) loginBtn.textContent = "Login";
    if (loginBtnMobile) loginBtnMobile.textContent = "Login";
    if (loggedInBar) loggedInBar.classList.remove("active");
  }
}

function logout() {
  localStorage.removeItem('evolve_user_email');
  currentUserEmail = null;
  applyAccess(false, null);
  ChatEngine.addBotMessage("You've been logged out. Login again to access your training.");
}

// =============================================================================
// NOTEBOOK
// =============================================================================
function toggleNotebook() { document.getElementById('notebookPanel').classList.toggle('open'); }
function loadNotebook() { const n = document.getElementById('notebookArea'); if (n) n.value = localStorage.getItem('evolve_notebook') || ''; }
function saveNotebook() { const n = document.getElementById('notebookArea'); if (n) localStorage.setItem('evolve_notebook', n.value); }

// =============================================================================
// DROPDOWNS
// =============================================================================
function closeAllDropdowns() {
  document.getElementById('stats-dropdown')?.classList.remove('active');
  document.getElementById('quicklinks-dropdown')?.classList.remove('active');
  document.getElementById('mobile-menu-dropdown')?.classList.remove('active');
}

function showLoginModal() { 
  document.getElementById('login-overlay')?.classList.remove('hidden'); 
  document.getElementById('login-status').textContent = '';
}

// =============================================================================
// WELCOME
// =============================================================================
function welcome() {
  ChatEngine.addBotMessage(userIsSubscribed 
    ? "Welcome back to Evolve!\n\nYour full access is active. You have access to:\n‚Ä¢ All 66 tests\n‚Ä¢ Micro drills\n‚Ä¢ Vocabulary builder\n\nSelect a test from the dashboard or click any button to learn more!"
    : "Welcome to the Evolve preview.\n\nThis is your IELTS and CELPIP training center with:\n‚Ä¢ 66 progressive tests\n‚Ä¢ Micro drills for targeted practice\n‚Ä¢ Vocabulary builder\n‚Ä¢ AI-powered scoring\n\nTo unlock full access, please log in or subscribe.\n\nClick any button in the dashboard to explore what's included!");
}

// =============================================================================
// FAQ HANDLER
// =============================================================================
function handleFAQ(faqKey) {
  const content = FAQ_CONTENT[faqKey];
  if (content) {
    ChatEngine.addBotMessage(content);
  } else {
    ChatEngine.addBotMessage(userIsSubscribed 
      ? "Content for this topic is coming soon!" 
      : "This feature is available in the full Evolve program. Subscribe to unlock!");
  }
}

// =============================================================================
// TEST BUTTONS
// =============================================================================
function initTestButtons() {
  // Main tests
  const configs = {
    "writing-foundation-tests": { start: 1, count: 11 },
    "writing-intermediate-tests": { start: 12, count: 11 },
    "writing-advanced-tests": { start: 23, count: 11 },
    "reading-foundation-tests": { start: 1, count: 11 },
    "reading-intermediate-tests": { start: 12, count: 11 },
    "reading-advanced-tests": { start: 23, count: 11 }
  };
  Object.entries(configs).forEach(([id, cfg]) => {
    const c = document.getElementById(id);
    if (!c) return;
    const type = id.includes('writing') ? 'Writing' : 'Reading';
    for (let i = 0; i < cfg.count; i++) {
      const b = document.createElement("button");
      b.className = "test-btn";
      b.textContent = type + " Test " + (cfg.start + i);
      b.addEventListener("click", () => {
        if (userIsSubscribed) {
          ChatEngine.addBotMessage("Starting " + type + " Test " + (cfg.start + i) + "...\n\n**Test engine coming in Phase 2!**\n\nThis will include:\n‚Ä¢ Timed prompts\n‚Ä¢ AI-powered scoring\n‚Ä¢ Detailed feedback on all criteria\n‚Ä¢ Score tracking");
        } else {
          ChatEngine.addBotMessage("üîí " + type + " Test " + (cfg.start + i) + " is locked.\n\nSubscribe to Evolve to unlock all 66 tests with AI-powered feedback and scoring.\n\nClick the yellow 'Unlock Full Evolve Access' button to get started!");
        }
      });
      c.appendChild(b);
    }
  });

  // Writing Micro Drills
  const writingMicro = document.getElementById("writing-micro-tests");
  if (writingMicro) {
    const drills = ["Paraphrase Practice", "Cohesion & Coherence", "Grammar Control", "Summarize & Condense", "Expand & Develop", "Tone & Formality"];
    drills.forEach((name) => {
      const b = document.createElement("button");
      b.className = "test-btn";
      b.textContent = "‚úèÔ∏è " + name;
      b.addEventListener("click", () => {
        if (userIsSubscribed) {
          ChatEngine.addBotMessage("Starting " + name + " Drill...\n\n**Micro Drill engine coming in Phase 2!**\n\nThis drill will help you:\n‚Ä¢ Practice " + name.toLowerCase() + " skills\n‚Ä¢ Get instant feedback\n‚Ä¢ Track improvement over time");
        } else {
          ChatEngine.addBotMessage("üîí " + name + " Drill is locked.\n\nSubscribe to unlock all micro drills for targeted skill practice!");
        }
      });
      writingMicro.appendChild(b);
    });
  }

  // Reading Micro Drills
  const readingMicro = document.getElementById("reading-micro-tests");
  if (readingMicro) {
    const drills = ["Scanning Practice", "Skimming Practice", "Vocabulary in Context", "Inference Skills", "Comprehension Check", "Critical Reading"];
    drills.forEach((name) => {
      const b = document.createElement("button");
      b.className = "test-btn";
      b.textContent = "üìñ " + name;
      b.addEventListener("click", () => {
        if (userIsSubscribed) {
          ChatEngine.addBotMessage("Starting " + name + "...\n\n**Micro Drill engine coming in Phase 2!**\n\nThis drill will help you:\n‚Ä¢ Practice " + name.toLowerCase() + "\n‚Ä¢ Build reading speed\n‚Ä¢ Improve comprehension accuracy");
        } else {
          ChatEngine.addBotMessage("üîí " + name + " is locked.\n\nSubscribe to unlock all micro drills for targeted skill practice!");
        }
      });
      readingMicro.appendChild(b);
    });
  }
}

// =============================================================================
// INITIALIZATION
// =============================================================================
document.addEventListener("DOMContentLoaded", async () => {
  console.log("Evolve initializing...");
  ChatEngine.init();
  loadNotebook();
  initTestButtons();

  // AUTO-LOGIN AFTER PAYMENT: Check URL params for paid=true
  const params = new URLSearchParams(window.location.search);
  if (params.get("paid") === "true" && params.get("email")) {
    const email = decodeURIComponent(params.get("email")).toLowerCase();
    console.log("Payment detected, auto-logging in:", email);
    
    // Store email and apply access immediately
    localStorage.setItem("evolve_user_email", email);
    currentUserEmail = email;
    applyAccess(true, email);
    
    // Clean URL (remove query params)
    window.history.replaceState({}, document.title, window.location.pathname);
    
    // Welcome message
    setTimeout(() => {
      ChatEngine.addBotMessage("üéâ Payment successful! Your Evolve subscription is now active.\n\nYou have full access to:\n‚Ä¢ All 66 tests\n‚Ä¢ Micro drills\n‚Ä¢ Vocabulary builder\n‚Ä¢ AI-powered scoring\n\nSelect a test from the dashboard to begin!");
    }, 500);
    
  } else if (params.get("cancelled") === "true") {
    // Payment was cancelled
    window.history.replaceState({}, document.title, window.location.pathname);
    setTimeout(() => {
      ChatEngine.addBotMessage("Payment was cancelled. No worries - click 'Unlock Full Evolve Access' when you're ready to subscribe.");
    }, 500);
    
  } else if (currentUserEmail) {
    // Check if user was previously logged in
    console.log("Found stored email:", currentUserEmail);
    const result = await checkEntitlement(currentUserEmail);
    if (result.active) {
      applyAccess(true, currentUserEmail);
    } else {
      localStorage.removeItem('evolve_user_email');
      currentUserEmail = null;
    }
  }

  // Notebook
  document.getElementById('btn-notebook')?.addEventListener('click', toggleNotebook);
  document.getElementById('btn-notebook-mobile')?.addEventListener('click', () => { closeAllDropdowns(); toggleNotebook(); });
  document.getElementById('notebook-close')?.addEventListener('click', toggleNotebook);
  document.getElementById('notebookArea')?.addEventListener('input', saveNotebook);

  // Quick Links
  document.getElementById('btn-quicklinks')?.addEventListener('click', (e) => { 
    e.stopPropagation(); 
    closeAllDropdowns();
    document.getElementById('quicklinks-dropdown')?.classList.toggle('active'); 
  });
  document.getElementById('btn-quicklinks-mobile')?.addEventListener('click', () => { 
    closeAllDropdowns(); 
    document.getElementById('quicklinks-dropdown')?.classList.toggle('active');
  });

  // Stats
  document.getElementById('btn-stats')?.addEventListener('click', (e) => {
    e.stopPropagation();
    closeAllDropdowns();
    document.getElementById('stats-dropdown')?.classList.toggle('active');
  });
  document.getElementById('btn-stats-mobile')?.addEventListener('click', (e) => {
    e.stopPropagation();
    closeAllDropdowns();
    document.getElementById('stats-dropdown')?.classList.toggle('active');
  });

  // Download
  document.getElementById('btn-download')?.addEventListener('click', () => {
    ChatEngine.addBotMessage(userIsSubscribed 
      ? "**Download Feature**\n\nThis feature is coming in Phase 3!\n\nYou'll be able to:\n‚Ä¢ Export your test history as PDF\n‚Ä¢ Download score reports\n‚Ä¢ Save your notebook content" 
      : "üîí Download is available in the full Evolve program.\n\nSubscribe to unlock PDF exports of your progress and scores!");
  });
  document.getElementById('btn-download-mobile')?.addEventListener('click', () => { 
    closeAllDropdowns(); 
    ChatEngine.addBotMessage(userIsSubscribed 
      ? "**Download Feature**\n\nThis feature is coming in Phase 3!" 
      : "üîí Download is available in the full Evolve program.");
  });

  // Reset
  const resetHandler = () => {
    if (!confirm("Clear chat and reset?")) return;
    document.getElementById("chat-body").innerHTML = "";
    welcome();
  };
  document.getElementById('btn-reset')?.addEventListener('click', resetHandler);
  document.getElementById('btn-reset-mobile')?.addEventListener('click', () => { closeAllDropdowns(); resetHandler(); });

  // Login/Logout
  const handleLoginClick = () => {
    if (userIsSubscribed && currentUserEmail) {
      logout();
    } else {
      showLoginModal();
    }
  };
  document.getElementById('btn-login')?.addEventListener('click', handleLoginClick);
  document.getElementById('btn-login-mobile')?.addEventListener('click', () => { closeAllDropdowns(); handleLoginClick(); });

  // Login modal
  document.getElementById('login-close')?.addEventListener('click', () => document.getElementById('login-overlay')?.classList.add('hidden'));
  document.getElementById('login-overlay')?.addEventListener('click', (e) => { if (e.target.id === 'login-overlay') document.getElementById('login-overlay')?.classList.add('hidden'); });
  
  // LOGIN SUBMIT - Real check
  document.getElementById('login-submit')?.addEventListener('click', async () => {
    const emailInput = document.getElementById("login-email");
    const status = document.getElementById("login-status");
    const email = emailInput.value.trim().toLowerCase();
    
    if (!email || !email.includes('@')) {
      status.textContent = "Please enter a valid email.";
      return;
    }
    
    status.textContent = "Checking subscription...";
    
    const result = await checkEntitlement(email);
    
    if (result.active) {
      currentUserEmail = email;
      localStorage.setItem('evolve_user_email', email);
      applyAccess(true, email);
      document.getElementById('login-overlay')?.classList.add('hidden');
      ChatEngine.addBotMessage("Welcome back! Your Evolve subscription is active.\n\nYou now have full access to all 66 tests.\n\nSelect a test from the dashboard to begin, or click any FAQ button to learn tips and strategies!");
    } else {
      status.innerHTML = 'No active subscription found.<br><a href="' + PAYMENT_LINKS.evolve + '" style="color:#A367B1;font-weight:bold;">Subscribe to Evolve ‚Üí</a>';
    }
  });

  // Mobile menu
  document.getElementById('btn-mobile-menu')?.addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('mobile-menu-dropdown')?.classList.toggle('active');
  });

  // Unlock button
  // Unlock button - creates checkout session
  document.getElementById('unlock-evolve')?.addEventListener('click', async () => {
    const email = prompt("Enter your email to continue to checkout:");
    if (!email || !email.includes('@')) {
      alert("Please enter a valid email address.");
      return;
    }
    
    try {
      ChatEngine.addBotMessage("Redirecting to secure checkout...");
      
      const res = await fetch(API_BASE + "/.netlify/functions/create-evolve-checkout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: email.toLowerCase(), product: "evolve" })
      });
      
      const data = await res.json();
      
      if (data.url) {
        window.location.href = data.url;
      } else {
        ChatEngine.addBotMessage("Error creating checkout. Please try again or contact info@migratenorth.ca");
      }
    } catch (err) {
      console.error("Checkout error:", err);
      ChatEngine.addBotMessage("Connection error. Please try again.");
    }
  });

  // New Test button
  document.getElementById('btn-new-test')?.addEventListener('click', () => {
    if (userIsSubscribed) {
      ChatEngine.addBotMessage("**Start a New Test**\n\nChoose from the Writing or Reading folders in the dashboard.\n\n**Recommendations:**\n‚Ä¢ New users: Start with Foundation tests\n‚Ä¢ Intermediate: Try Intermediate tests\n‚Ä¢ Advanced: Challenge yourself with Advanced tests\n\nClick on 'Open Writing' or 'Open Reading' to see all available tests!");
    } else {
      ChatEngine.addBotMessage("üîí Tests are available in the full Evolve program.\n\nSubscribe to unlock all 66 tests with AI-powered scoring and feedback!");
    }
  });

  // Refine button
  document.getElementById('chat-refine')?.addEventListener('click', () => {
    if (userIsSubscribed) {
      ChatEngine.addBotMessage("**Refine Feature**\n\nUse the Refine button after receiving feedback to:\n\n‚Ä¢ Get suggestions for improving your answer\n‚Ä¢ See alternative phrasings\n‚Ä¢ Learn better vocabulary choices\n‚Ä¢ Strengthen your argument structure\n\n**Coming in Phase 2!**\n\nFor now, review your feedback and try rewriting your answer in the input box.");
    } else {
      ChatEngine.addBotMessage("üîí The Refine feature is available in the full Evolve program.");
    }
  });

  // Folders
  document.querySelectorAll('.folder-header').forEach(h => h.addEventListener('click', () => {
    const l = document.getElementById(h.dataset.folder + '-tests');
    h.classList.toggle('open');
    l?.classList.toggle('open');
  }));
  document.querySelectorAll('.sub-folder-header').forEach(h => h.addEventListener('click', (e) => {
    e.stopPropagation();
    const l = document.getElementById(h.dataset.subfolder + '-tests');
    h.classList.toggle('open');
    l?.classList.toggle('open');
  }));

  // FAQ buttons - Now with real content!
  document.querySelectorAll('[data-faq]').forEach(b => {
    b.addEventListener('click', () => {
      const faqKey = b.getAttribute('data-faq');
      handleFAQ(faqKey);
    });  });

  // Close dropdowns on outside click
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#progress-container')) closeAllDropdowns();
  });

  welcome();
  console.log("Evolve ready!");
});
</script>
</body>
</html>
